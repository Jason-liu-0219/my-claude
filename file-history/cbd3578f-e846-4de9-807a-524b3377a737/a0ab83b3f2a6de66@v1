---
name: pr
description: Use when user says "ç™¼ PR", "create PR", "é–‹ PR", "/pr", or wants to create a pull request for vsaas-portal changes. Automatically generates PR title, description, and assigns reviewers.
version: 1.0.0
---

# PR - è‡ªå‹•å»ºç«‹ Pull Request

é‡å° `app-vsaas-portal` å°ˆæ¡ˆè‡ªå‹•å»ºç«‹ PRï¼ŒåŒ…å«æ¨™é¡Œç”Ÿæˆã€æè¿°ç”Ÿæˆå’Œ reviewer æŒ‡æ´¾ã€‚

## ä½¿ç”¨æ–¹å¼

ç•¶ä½¿ç”¨è€…èªª `/pr` æˆ–ã€Œç™¼ PRã€æ™‚åŸ·è¡Œæ­¤ skillã€‚

## åŸ·è¡Œæ­¥é©Ÿ

### Step 1: ç¢ºèªå·¥ä½œç›®éŒ„å’Œåˆ†æ”¯

```bash
# ç¢ºèªåœ¨ monorepo æ ¹ç›®éŒ„
cd /Users/liuhanwen/Desktop/project/webtech-monorepo

# å–å¾—ç•¶å‰åˆ†æ”¯
CURRENT_BRANCH=$(git branch --show-current)
echo "ç•¶å‰åˆ†æ”¯: $CURRENT_BRANCH"

# ç¢ºèªä¸æ˜¯ main åˆ†æ”¯
if [ "$CURRENT_BRANCH" = "main" ]; then
  echo "éŒ¯èª¤ï¼šä¸èƒ½å¾ main åˆ†æ”¯å»ºç«‹ PR"
  exit 1
fi
```

### Step 2: å–å¾—è®Šæ›´è³‡è¨Š

```bash
# å–å¾—ç›¸å°æ–¼ main çš„è®Šæ›´æª”æ¡ˆ
CHANGED_FILES=$(git diff --name-only main)
echo "è®Šæ›´æª”æ¡ˆ:"
echo "$CHANGED_FILES"

# ç¢ºèªæ˜¯ vsaas-portal çš„è®Šæ›´
if ! echo "$CHANGED_FILES" | grep -q "packages/app-vsaas-portal"; then
  echo "è­¦å‘Šï¼šè®Šæ›´ä¸åœ¨ app-vsaas-portal ç¯„åœå…§"
fi

# å–å¾— commits
COMMITS=$(git log main..HEAD --oneline)
echo "Commits:"
echo "$COMMITS"
```

### Step 3: ç”Ÿæˆ PR æ¨™é¡Œ

å¾ç¬¬ä¸€å€‹ commit æˆ–åˆ†æ”¯åç¨±æ¨æ–·æ¨™é¡Œï¼š

```bash
# å„ªå…ˆä½¿ç”¨ç¬¬ä¸€å€‹ commit è¨Šæ¯
FIRST_COMMIT=$(git log main..HEAD --oneline --format="%s" | tail -1)

# å¦‚æœ commit å·²ç¬¦åˆ conventional commits æ ¼å¼ï¼Œç›´æ¥ä½¿ç”¨
if echo "$FIRST_COMMIT" | grep -qE "^(feat|fix|docs|style|refactor|perf|test|chore|ci)\("; then
  PR_TITLE="$FIRST_COMMIT"
else
  # å¾åˆ†æ”¯åæ¨æ–· type
  if echo "$CURRENT_BRANCH" | grep -qiE "^fix"; then
    TYPE="fix"
  elif echo "$CURRENT_BRANCH" | grep -qiE "^feat"; then
    TYPE="feat"
  else
    TYPE="fix"  # é è¨­
  fi
  
  # çµ„åˆæ¨™é¡Œ
  PR_TITLE="${TYPE}(vsaas-portal): ${FIRST_COMMIT}"
fi

echo "PR æ¨™é¡Œ: $PR_TITLE"
```

### Step 4: ç”Ÿæˆ PR æè¿°

ç²¾ç°¡æ ¼å¼ï¼š

```bash
# ç”Ÿæˆè®Šæ›´æ¸…å–®
CHANGES=$(git log main..HEAD --oneline --format="- %s")

PR_BODY="## Changes
${CHANGES}

## Checklist
- [ ] Code follows project conventions
- [ ] Tests added/updated
- [ ] Build passes locally"

echo "PR æè¿°:"
echo "$PR_BODY"
```

### Step 5: æ±ºå®š Reviewer

```bash
# å–å¾—è®Šæ›´æª”æ¡ˆçš„æœ€å¾Œæäº¤è€…
CHANGED_FILES_LIST=$(git diff --name-only main | head -1)
LAST_AUTHOR=$(git log -1 --format='%aN' -- "$CHANGED_FILES_LIST" 2>/dev/null)
CURRENT_USER=$(git config user.name)

# æ±ºå®š reviewer
if [ -n "$LAST_AUTHOR" ] && [ "$LAST_AUTHOR" != "$CURRENT_USER" ]; then
  # å˜—è©¦å–å¾— GitHub username
  REVIEWER_EMAIL=$(git log -1 --format='%aE' -- "$CHANGED_FILES_LIST")
  # å¾ email æå– usernameï¼ˆå‡è¨­æ ¼å¼ç‚º username@domainï¼‰
  REVIEWER=$(echo "$REVIEWER_EMAIL" | cut -d'@' -f1)
else
  REVIEWER="MarcoLin01"
fi

echo "Reviewer: $REVIEWER"
```

### Step 6: å»ºç«‹ PR

```bash
# ç¢ºèªé ç«¯å·²æ¨é€
git push origin "$CURRENT_BRANCH" 2>/dev/null || git push -u origin "$CURRENT_BRANCH"

# å»ºç«‹ PR
gh pr create \
  --base main \
  --title "$PR_TITLE" \
  --body "$PR_BODY" \
  --reviewer "$REVIEWER"
```

## å®Œæ•´è…³æœ¬

å°‡ä»¥ä¸Šæ­¥é©Ÿçµ„åˆæˆå®Œæ•´åŸ·è¡Œæµç¨‹ï¼š

```bash
#!/bin/bash
set -e

# 1. ç’°å¢ƒæª¢æŸ¥
CURRENT_BRANCH=$(git branch --show-current)
if [ "$CURRENT_BRANCH" = "main" ]; then
  echo "âŒ ä¸èƒ½å¾ main åˆ†æ”¯å»ºç«‹ PR"
  exit 1
fi

# 2. å–å¾—è®Šæ›´
CHANGED_FILES=$(git diff --name-only main)
if [ -z "$CHANGED_FILES" ]; then
  echo "âŒ æ²’æœ‰ç›¸å°æ–¼ main çš„è®Šæ›´"
  exit 1
fi

# 3. ç”Ÿæˆæ¨™é¡Œ
FIRST_COMMIT=$(git log main..HEAD --oneline --format="%s" | tail -1)
if echo "$FIRST_COMMIT" | grep -qE "^(feat|fix|docs|style|refactor|perf|test|chore|ci)\("; then
  PR_TITLE="$FIRST_COMMIT"
else
  TYPE="fix"
  echo "$CURRENT_BRANCH" | grep -qiE "^feat" && TYPE="feat"
  PR_TITLE="${TYPE}(vsaas-portal): ${FIRST_COMMIT}"
fi

# 4. ç”Ÿæˆæè¿°
CHANGES=$(git log main..HEAD --oneline --format="- %s")
PR_BODY="## Changes
${CHANGES}

## Checklist
- [ ] Code follows project conventions
- [ ] Tests added/updated
- [ ] Build passes locally"

# 5. æ±ºå®š Reviewer
FIRST_FILE=$(echo "$CHANGED_FILES" | head -1)
LAST_AUTHOR=$(git log -1 --format='%aN' -- "$FIRST_FILE" 2>/dev/null || echo "")
CURRENT_USER=$(git config user.name)

if [ -n "$LAST_AUTHOR" ] && [ "$LAST_AUTHOR" != "$CURRENT_USER" ]; then
  REVIEWER_EMAIL=$(git log -1 --format='%aE' -- "$FIRST_FILE")
  REVIEWER=$(echo "$REVIEWER_EMAIL" | cut -d'@' -f1)
else
  REVIEWER="MarcoLin01"
fi

# 6. é¡¯ç¤ºé è¦½
echo "================================"
echo "ğŸ“‹ PR é è¦½"
echo "================================"
echo "åˆ†æ”¯: $CURRENT_BRANCH â†’ main"
echo "æ¨™é¡Œ: $PR_TITLE"
echo "Reviewer: $REVIEWER"
echo ""
echo "æè¿°:"
echo "$PR_BODY"
echo "================================"

# 7. æ¨é€ä¸¦å»ºç«‹ PR
echo ""
echo "ğŸš€ æ¨é€åˆ†æ”¯..."
git push origin "$CURRENT_BRANCH" 2>/dev/null || git push -u origin "$CURRENT_BRANCH"

echo "ğŸ“¤ å»ºç«‹ PR..."
gh pr create \
  --base main \
  --title "$PR_TITLE" \
  --body "$PR_BODY" \
  --reviewer "$REVIEWER"

echo "âœ… PR å»ºç«‹å®Œæˆï¼"
```

## Commit é¡å‹åƒè€ƒ

| Type | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| feat | æ–°åŠŸèƒ½ | `feat(vsaas-portal): add user filter` |
| fix | ä¿®å¾© | `fix(vsaas-portal): fix table sorting` |
| docs | æ–‡ä»¶ | `docs(vsaas-portal): update README` |
| refactor | é‡æ§‹ | `refactor(vsaas-portal): simplify auth logic` |
| style | æ ¼å¼ | `style(vsaas-portal): format code` |
| test | æ¸¬è©¦ | `test(vsaas-portal): add unit tests` |
| chore | ç¶­è­· | `chore(vsaas-portal): update deps` |

## æ³¨æ„äº‹é …

1. **ç¢ºèª gh CLI å·²ç™»å…¥**ï¼šåŸ·è¡Œ `gh auth status` æª¢æŸ¥
2. **ç¢ºèªåˆ†æ”¯å·²æ¨é€**ï¼šPR éœ€è¦é ç«¯åˆ†æ”¯å­˜åœ¨
3. **BREAKING CHANGE**ï¼šé¿å…åœ¨ commit ä¸­ä½¿ç”¨ï¼Œæœƒè§¸ç™¼ MAJOR ç‰ˆæœ¬
4. **åƒ…é™ vsaas-portal**ï¼šæ­¤ skill å°ˆç‚º app-vsaas-portal è¨­è¨ˆ
