---
name: worktree-pr
description: Use when user wants to work on a task in isolation using git worktree, then create PR and self-review. Triggers on keywords like "worktree", "ç¨ç«‹é–‹ç™¼", "é–‹æ–°åˆ†æ”¯è™•ç†", "worktree pr", "éš”é›¢é–‹ç™¼".
version: 2.0.0
---

# Worktree PR Skill

ä½¿ç”¨ Git Worktree å¿«é€Ÿè™•ç†ä»»å‹™ï¼Œå®Œæˆå¾Œè‡ªå‹•ç™¼ PR ä¸¦é€²è¡Œ self reviewã€‚

---

## ä½¿ç”¨æ–¹å¼

```bash
/worktree-pr fix/bug-name "ä¿®å¾©æŸå€‹å•é¡Œ"
```

---

## æ ¸å¿ƒæµç¨‹

```
1. git fetch origin main
2. git worktree add ï¼ˆåŸºæ–¼æœ€æ–° mainï¼‰
3. è™•ç†ä»»å‹™ï¼ˆä¿®æ”¹ç¨‹å¼ç¢¼ï¼‰
4. git commit & push
5. gh pr create
6. è‡ªå‹• self reviewï¼ˆæäº¤åˆ° GitHubï¼‰
```

---

## åŸ·è¡Œæ­¥é©Ÿ

### Step 1ï¼šå»ºç«‹ Worktreeï¼ˆåŸºæ–¼æœ€æ–° mainï¼‰

```bash
BRANCH_NAME="fix/bug-name"
REPO_ROOT=$(git rev-parse --show-toplevel)
WORKTREE_DIR="${REPO_ROOT}/../worktrees/${BRANCH_NAME//\//-}"

# å¿…é ˆï¼šå–å¾—æœ€æ–° main
git fetch origin main --prune

# å»ºç«‹ worktree
git worktree add "$WORKTREE_DIR" -b "$BRANCH_NAME" origin/main

# é€²å…¥ worktree
cd "$WORKTREE_DIR"
```

### Step 2ï¼šè™•ç†ä»»å‹™

åœ¨ worktree ç›®éŒ„ä¸­é€²è¡Œç¨‹å¼ç¢¼ä¿®æ”¹ã€‚

### Step 3ï¼šCommit & Push

```bash
git add .
git commit -m "fix(vsaas-portal): ä¿®å¾©æè¿°"
git push -u origin "$BRANCH_NAME"
```

### Step 4ï¼šå»ºç«‹ PR

```bash
FIRST_COMMIT=$(git log origin/main..HEAD --format="%s" | tail -1)

gh pr create \
  --base main \
  --title "$FIRST_COMMIT" \
  --body "## Changes
$(git log origin/main..HEAD --format="- %s")

## Checklist
- [ ] Code follows project conventions
- [ ] Build passes locally"
```

### Step 5ï¼šSelf Review

```bash
PR_NUMBER=$(gh pr view --json number -q '.number')
REPO=$(gh repo view --json nameWithOwner -q '.nameWithOwner')
COMMIT_ID=$(gh pr view --json headRefOid -q '.headRefOid')

# å»ºç«‹ reviewï¼ˆå«è¡Œå…§è©•è«–ï¼‰
cat > /tmp/review.json << JSONEOF
{
  "commit_id": "${COMMIT_ID}",
  "body": "## Self Review\n\nâœ… å·²ç¢ºèªé‚è¼¯æ­£ç¢º\n\n**è©•åˆ†**: â­â­â­â­â­",
  "event": "COMMENT",
  "comments": [
    {
      "path": "path/to/file.vue",
      "line": 42,
      "side": "RIGHT",
      "body": "ðŸ‘ ä¿®æ”¹æ­£ç¢º"
    }
  ]
}
JSONEOF

gh api -X POST "/repos/${REPO}/pulls/${PR_NUMBER}/reviews" --input /tmp/review.json
```

---

## æ¸…ç†

```bash
# å›žåˆ°ä¸»ç›®éŒ„
cd "$REPO_ROOT"

# ç§»é™¤ worktree
git worktree remove "$WORKTREE_DIR"
```

---

## æ³¨æ„äº‹é …

1. **å¿…é ˆå¾žæœ€æ–° main é–‹å§‹**ï¼š`git fetch origin main` ä¸å¯çœç•¥
2. **Self review ä½¿ç”¨ COMMENT**ï¼šå› ç‚ºä¸èƒ½ approve è‡ªå·±çš„ PR

---

## æ›´æ–°æ—¥èªŒ

### v2.0.0 (2025-02-01)
- å¤§å¹…ç°¡åŒ–ï¼Œå°ˆæ³¨æ ¸å¿ƒæµç¨‹
- ç§»é™¤ä¸å¿…è¦çš„æ­¥é©Ÿï¼ˆå®‰è£ä¾è³´ã€è·‘æ¸¬è©¦ï¼‰
- é‡é»žï¼šå¿«é€Ÿè™•ç† â†’ ç™¼ PR â†’ self review
