/* eslint-disable no-unreachable */
/* eslint-disable no-unused-expressions */
import { DEVICE_TYPE } from '@vivotek/const-vsaas';
import VDSI from '../vdsi';
import ComposeVsaasDeviceId from '../utility/composeVsaasDeviceId';
import parseDeviceId from '../utility/parseDeviceId';
import GetFirmwareState from '../utility/getFirmwareState';

export default class Configurator extends VDSI {
  name = 'configurator';

  constructor(reference) {
    super(reference);

    this.updateState({
      support: {},
      ready: false
    });
  }

  // eslint-disable-next-line class-methods-use-this
  get QUERIES() {
    return [
      // Connection & Auth
      'apiDomain',
      'apiToken',

      // Backend Identifiers
      'deviceId',
      'thingName',
      'aiObjectSearchKey',

      // Device Identity
      'mac',
      'model',
      'type',
      'localIP',
      'city',
      'firmware',
      'siteID',

      // Status & Capabilities
      'cameraType',
      'isUnknownDevice',
      'online',
      'recording',
      'fisheye',
      'ptz',
      'vca',
      'modelType',
      'isPremiumCategory',
      'isEssentialCategory',
      'fwUpgradeState',
      'fwUpgradeVersion',
      'storageCapacity',

      // UI Display
      'displayName',
      'groupName',
      'generalIconClass',
      'statelessModelIcon',
    ];
  }

  // Connection & Auth

  get apiToken() {
    return this.reference.options?.apiToken;
  }

  get apiDomain() {
    return this.reference.options?.apiDomain || 'api.vortexcloud.com';
  }

  // Backend Identifiers

  get deviceId() {
    return ComposeVsaasDeviceId(this.reference.options);
  }

  get thingName() {
    if (this.reference.options?.thingName) {
      return this.reference.options?.thingName;
    }
    const { thingName } = parseDeviceId(this.reference.options?.deviceId);
    return thingName;
  }

  get aiObjectSearchKey() {
    return this.mac;
  }

  // Device Identity

  get mac() {
    return this.reference.options?.mac;
  }

  get model() {
    return this.reference.options?.model;
  }

  get type() {
    return DEVICE_TYPE.CAMERA;
  }

  get localIP() {
    return this.reference.options?.ip;
  }

  get city() {
    return this.reference.options?.city;
  }

  set city(value) {
    this.reference.options.city = value;
  }

  get firmware() {
    return this.reference.options?.firmware;
  }

  get siteID() {
    return this.reference.options.siteID;
  }

  set siteID(value) {
    this.reference.options.siteID = value;
  }

  // Status & Capabilities

  get cameraType() {
    const map = {
      fisheye: this.fisheye,
      ptz: this.ptz
    };

    return Object.keys(map).find((key) => map[key]) || 'default';
  }

  get isUnknownDevice() {
    return this.reference.options?.type === 'unknownDevice';
  }

  get online() {
    // eslint-disable-next-line class-methods-use-this
    return true;
  }

  get recording() {
    return this.reference.options?.recording;
  }

  get fisheye() {
    return this.reference.options?.fisheye || false;
  }

  get ptz() {
    return this.reference.options?.ptz || false;
  }

  get vca() {
    return this.reference.options?.vca;
  }

  get modelType() {
    return this.reference.options?.modelType || this.reference.options?.modelCategory || 'Essential';
  }

  get isPremiumCategory() {
    return this.modelType === 'Premium';
  }

  get isEssentialCategory() {
    return this.modelType === 'Essential';
  }

  get fwUpgradeState() {
    return GetFirmwareState(this.reference.options?.fwUpgradeState);
  }

  get fwUpgradeVersion() {
    return this.reference.options?.fwUpgradeVersion;
  }

  get storageCapacity() {
    return this.reference.options?.storageCapacity;
  }

  // UI Display

  get displayName() {
    return this.reference.options.name || this.reference.options.mac;
  }

  set displayName(value) {
    this.reference.options.name = value;
  }

  get groupName() {
    return this.reference.options.groupName;
  }

  set groupName(value) {
    this.reference.options.groupName = value;
  }

  get generalIconClass() {
    const type = this.cameraType;

    if (this.fwUpgradeState === 'upgrading') {
      return `status_camera_${type}_updating_solid_normal`;
    }

    if (this.recording && this.online) {
      return `status_camera_${type}_recording`;
    }

    return this.online ? `status_camera_${type}` : `status_camera_${type}_disconnected`;
  }

  get statelessModelIcon() {
    const type = this.cameraType;

    return `status_camera_${type}`;
  }
}
