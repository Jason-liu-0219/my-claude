---
name: debug-investigator
description: æ·±åº¦å•é¡Œèª¿æŸ¥å·¥å…· - åˆ†æå•é¡Œã€è¿½æº¯ä»£ç¢¼æ­·å²ã€å®šä½å¯ç–‘æ”¹å‹•èˆ‡ commitã€‚ç”¨æ–¼ debugã€æ’æŸ¥ regressionã€æ‰¾å‡ºå•é¡Œæ ¹å› ã€‚
allowed-tools: Bash, Read, Grep, Glob, Task
---

# Debug Investigator - å•é¡Œèª¿æŸ¥å°ˆå®¶

å°ˆæ¥­çš„å•é¡Œèª¿æŸ¥æŠ€èƒ½ï¼Œçµåˆä»£ç¢¼åˆ†æèˆ‡ Git æ­·å²è¿½æº¯ï¼Œå¿«é€Ÿå®šä½å•é¡Œæ ¹å› ã€‚

## è§¸ç™¼æ¢ä»¶

ç•¶ç”¨æˆ¶é‡åˆ°ä»¥ä¸‹æƒ…æ³æ™‚è‡ªå‹•å•Ÿç”¨ï¼š
- Bug èª¿æŸ¥èˆ‡ debug
- åŠŸèƒ½çªç„¶å£æ‰ï¼ˆregressionï¼‰
- éœ€è¦æ‰¾å‡ºã€Œæ˜¯å“ªæ¬¡æ”¹å‹•é€ æˆçš„ã€
- ä»£ç¢¼è¡Œç‚ºèˆ‡é æœŸä¸ç¬¦
- éœ€è¦è¿½æº¯ç‰¹å®šåŠŸèƒ½çš„ä¿®æ”¹æ­·å²

## èª¿æŸ¥æµç¨‹

### Phase 1: å•é¡Œç†è§£èˆ‡ç¯„åœç•Œå®š

```
1. é‡æ¸…å•é¡Œç¾è±¡
   - éŒ¯èª¤è¨Šæ¯æ˜¯ä»€éº¼ï¼Ÿ
   - é æœŸè¡Œç‚º vs å¯¦éš›è¡Œç‚º
   - å•é¡Œæ˜¯å¦å¯é‡ç¾ï¼Ÿ
   - ä½•æ™‚é–‹å§‹å‡ºç¾ï¼Ÿï¼ˆé—œéµç·šç´¢ï¼‰

2. ç¢ºå®šå½±éŸ¿ç¯„åœ
   - å“ªäº›åŠŸèƒ½å—å½±éŸ¿ï¼Ÿ
   - å“ªäº›æª”æ¡ˆ/æ¨¡çµ„å¯èƒ½ç›¸é—œï¼Ÿ
   - æ˜¯å¦æœ‰ç›¸é—œçš„éŒ¯èª¤æ—¥èªŒï¼Ÿ
```

### Phase 2: ç•¶å‰ä»£ç¢¼åˆ†æ

```bash
# æ‰¾å‡ºç›¸é—œæª”æ¡ˆ
rg -l "é—œéµå­—" --type ts

# åˆ†æéŒ¯èª¤å †ç–Šä¸­çš„æª”æ¡ˆ
# æª¢æŸ¥å¯ç–‘å‡½æ•¸çš„å¯¦ç¾
```

**åˆ†æé‡é»ï¼š**
- éŒ¯èª¤ç™¼ç”Ÿçš„ç¢ºåˆ‡ä½ç½®
- ç›¸é—œå‡½æ•¸çš„èª¿ç”¨éˆ
- ä¾è³´é—œä¿‚èˆ‡æ•¸æ“šæµ

### Phase 3: Git æ­·å²è¿½æº¯

#### 3.1 æŸ¥çœ‹æª”æ¡ˆä¿®æ”¹æ­·å²

```bash
# æŸ¥çœ‹ç‰¹å®šæª”æ¡ˆçš„ä¿®æ”¹æ­·å²
git log --oneline -20 -- <file>

# æŸ¥çœ‹è©³ç´°æ”¹å‹•å…§å®¹
git log -p --follow -S "å¯ç–‘ä»£ç¢¼ç‰‡æ®µ" -- <file>

# æŸ¥çœ‹ç‰¹å®šæ™‚é–“ç¯„åœçš„ä¿®æ”¹
git log --oneline --since="2 weeks ago" -- <file>
```

#### 3.2 Git Blame å®šä½

```bash
# æ‰¾å‡ºæ¯è¡Œä»£ç¢¼çš„æœ€å¾Œä¿®æ”¹è€…èˆ‡ commit
git blame <file>

# åªçœ‹ç‰¹å®šè¡Œç¯„åœ
git blame -L 100,150 <file>

# å¿½ç•¥ç©ºç™½è®Šæ›´
git blame -w <file>

# è¿½æº¯è¢«ç§»å‹•/è¤‡è£½çš„ä»£ç¢¼
git blame -C -C <file>
```

#### 3.3 æœç´¢ç‰¹å®šæ”¹å‹•

```bash
# æœç´¢æ·»åŠ æˆ–åˆªé™¤ç‰¹å®šä»£ç¢¼çš„ commit
git log -S "functionName" --oneline

# ä½¿ç”¨æ­£å‰‡æœç´¢
git log -G "pattern.*regex" --oneline

# æœç´¢ commit message
git log --grep="fix\|bug\|issue" --oneline
```

#### 3.4 æ¯”è¼ƒç‰ˆæœ¬å·®ç•°

```bash
# æ¯”è¼ƒå…©å€‹ commit ä¹‹é–“çš„å·®ç•°
git diff <old-commit> <new-commit> -- <file>

# æ¯”è¼ƒç•¶å‰èˆ‡æŸå€‹æ™‚é–“é»
git diff HEAD~10 -- <file>

# æŸ¥çœ‹æŸæ¬¡ commit çš„å®Œæ•´æ”¹å‹•
git show <commit-hash>

# åˆ—å‡ºæŸæ¬¡ commit æ”¹å‹•çš„æª”æ¡ˆ
git show --stat <commit-hash>
```

### Phase 4: äºŒåˆ†æ³•å®šä½ï¼ˆGit Bisectï¼‰

ç•¶çŸ¥é“ã€Œä»¥å‰æ­£å¸¸ï¼Œç¾åœ¨å£äº†ã€æ™‚ä½¿ç”¨ï¼š

```bash
# é–‹å§‹äºŒåˆ†æœç´¢
git bisect start

# æ¨™è¨˜ç•¶å‰ç‰ˆæœ¬æœ‰å•é¡Œ
git bisect bad

# æ¨™è¨˜å·²çŸ¥æ­£å¸¸çš„ç‰ˆæœ¬
git bisect good <known-good-commit>

# Git æœƒè‡ªå‹• checkout ä¸­é–“ç‰ˆæœ¬ï¼Œæ¸¬è©¦å¾Œæ¨™è¨˜
git bisect good  # æˆ– git bisect bad

# æ‰¾åˆ°å•é¡Œ commit å¾Œé‡ç½®
git bisect reset
```

**è‡ªå‹•åŒ– bisectï¼š**
```bash
# ä½¿ç”¨è…³æœ¬è‡ªå‹•æ¸¬è©¦
git bisect run npm test
git bisect run ./test-script.sh
```

### Phase 5: é—œè¯åˆ†æ

#### 5.1 æŸ¥æ‰¾ç›¸é—œ commits

```bash
# æŸ¥çœ‹åŒä¸€ä½œè€…çš„è¿‘æœŸæ”¹å‹•
git log --author="name" --oneline -20

# æŸ¥çœ‹åŒä¸€ PR/åˆ†æ”¯çš„æ”¹å‹•
git log --oneline main..<branch>

# æŸ¥çœ‹æŸå€‹ commit çš„çˆ¶ commit
git log --oneline -5 <commit>^
```

#### 5.2 è¿½æº¯ä¾è³´è®Šæ›´

```bash
# æª¢æŸ¥ package.json è®Šæ›´
git log -p -- package.json | grep -A5 -B5 "dependency-name"

# æª¢æŸ¥é…ç½®æª”è®Šæ›´
git log --oneline -- "*.config.*" "*.json" "*.yaml"
```

## èª¿æŸ¥å ±å‘Šæ¨¡æ¿

å®Œæˆèª¿æŸ¥å¾Œï¼Œæä¾›çµæ§‹åŒ–å ±å‘Šï¼š

```markdown
## å•é¡Œèª¿æŸ¥å ±å‘Š

### å•é¡Œæè¿°
- **ç¾è±¡**: [æè¿°å•é¡Œ]
- **å½±éŸ¿ç¯„åœ**: [å—å½±éŸ¿çš„åŠŸèƒ½/æ¨¡çµ„]
- **é‡ç¾æ­¥é©Ÿ**: [å¦‚ä½•é‡ç¾]

### æ ¹å› åˆ†æ

#### å¯ç–‘ Commit
| Commit | ä½œè€… | æ—¥æœŸ | æè¿° | å¯ç–‘ç¨‹åº¦ |
|--------|------|------|------|----------|
| abc123 | @dev | 2024-01-15 | feat: xxx | âš ï¸ é«˜ |
| def456 | @dev | 2024-01-14 | fix: yyy | ğŸ” ä¸­ |

#### å•é¡Œä»£ç¢¼ä½ç½®
- `src/module/file.ts:123` - [å•é¡Œæè¿°]

#### æ”¹å‹•æ™‚é–“ç·š
1. `2024-01-10` - åŠŸèƒ½æ­£å¸¸ï¼ˆcommit: aaa111ï¼‰
2. `2024-01-12` - å¼•å…¥æ”¹å‹•ï¼ˆcommit: bbb222ï¼‰â† **å¯èƒ½çš„å•é¡Œé»**
3. `2024-01-15` - ç™¼ç¾å•é¡Œ

### å»ºè­°ä¿®å¾©æ–¹æ¡ˆ
1. [æ–¹æ¡ˆä¸€]
2. [æ–¹æ¡ˆäºŒ]

### é©—è­‰æ–¹å¼
- [ ] æ¸¬è©¦æ¡ˆä¾‹
- [ ] å›æ­¸æ¸¬è©¦
```

## å¸¸ç”¨èª¿æŸ¥å‘½ä»¤é€ŸæŸ¥

### å¿«é€Ÿå®šä½

```bash
# èª°æœ€å¾Œæ”¹äº†é€™å€‹æª”æ¡ˆ
git log -1 --format="%an - %s" -- <file>

# é€™å€‹å‡½æ•¸ä»€éº¼æ™‚å€™åŠ çš„
git log -S "function functionName" --oneline --diff-filter=A

# é€™è¡Œä»£ç¢¼ä»€éº¼æ™‚å€™æ”¹çš„
git log -L '/pattern/,+1:filename'
```

### çµ±è¨ˆåˆ†æ

```bash
# å“ªäº›æª”æ¡ˆæœ€å¸¸è¢«ä¿®æ”¹ï¼ˆå¯èƒ½æ˜¯å•é¡Œç†±é»ï¼‰
git log --pretty=format: --name-only | sort | uniq -c | sort -rg | head -20

# æŸå€‹æ™‚é–“æ®µçš„æ´»èºä½œè€…
git shortlog -sn --since="1 month ago"

# æŸæª”æ¡ˆçš„ä¿®æ”¹é »ç‡
git log --oneline -- <file> | wc -l
```

### ç·Šæ€¥å›é€€

```bash
# æŸ¥çœ‹å¯ä»¥å›é€€åˆ°çš„ç‰ˆæœ¬
git reflog

# æš«æ™‚å›åˆ°æŸå€‹ç‰ˆæœ¬æ¸¬è©¦
git checkout <commit> -- <file>

# å›é€€æŸæ¬¡ commitï¼ˆç”¢ç”Ÿæ–° commitï¼‰
git revert <commit>
```

## é€²éšæŠ€å·§

### 1. çµ„åˆæœç´¢

```bash
# æ‰¾å‡ºç‰¹å®šä½œè€…åœ¨ç‰¹å®šæ™‚é–“æ”¹å‹•ç‰¹å®šæª”æ¡ˆ
git log --author="name" --since="2024-01-01" --until="2024-01-31" -- "src/**/*.ts"
```

### 2. è¿½æº¯é‡æ§‹

```bash
# æª”æ¡ˆè¢«é‡å‘½åæ™‚è¿½æº¯æ­·å²
git log --follow -- <current-file-path>

# ä»£ç¢¼è¢«ç§»å‹•åˆ°å…¶ä»–æª”æ¡ˆ
git log -C -C -p -S "codeSnippet"
```

### 3. çµåˆ IDE

```bash
# VS Code é–‹å•Ÿ blame è¦–åœ–
code --goto <file>:<line>

# åœ¨ GitHub ä¸ŠæŸ¥çœ‹ blame
# https://github.com/org/repo/blame/main/path/to/file
```

## æ³¨æ„äº‹é …

1. **ä¿ç•™ç¾å ´** - èª¿æŸ¥å‰å…ˆ stash æˆ– commit ç•¶å‰æ”¹å‹•
2. **æ™‚é–“ç¯„åœ** - å…ˆç¸®å°å¯ç–‘æ™‚é–“ç¯„åœå†æ·±å…¥
3. **ç›¸é—œæ€§** - æ³¨æ„çœ‹ä¼¼ç„¡é—œçš„æ”¹å‹•ï¼ˆå¦‚ä¾è³´æ›´æ–°ã€é…ç½®è®Šæ›´ï¼‰
4. **å¤šè§’åº¦** - çµåˆ git historyã€éŒ¯èª¤æ—¥èªŒã€ç›£æ§æ•¸æ“š
5. **è¨˜éŒ„éç¨‹** - è¨˜éŒ„èª¿æŸ¥æ­¥é©Ÿï¼Œæ–¹ä¾¿å›é¡§èˆ‡åˆ†äº«
